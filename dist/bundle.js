/*!
 * flappy bird.js v1.0.0
 * (c) 2020 Lin.JY
 * Released under the MIT License.
 */
"use strict";window.imgs={bg:new Image,grass:new Image,title:new Image,bird0:new Image,bird1:new Image,up_bird0:new Image,up_bird1:new Image,down_bird0:new Image,down_bird1:new Image,startBtn:new Image,up_pipe:new Image,up_mod:new Image,down_pipe:new Image,down_mod:new Image,loadImg:function(i){this.bg.src="https://i.niupic.com/images/2020/09/04/8CXx.jpg",this.bird0.src="https://i.niupic.com/images/2020/09/04/8CXA.png",this.bird1.src="https://i.niupic.com/images/2020/09/04/8CXC.png",this.up_bird0.src="https://i.niupic.com/images/2020/09/04/8CXO.png",this.up_bird1.src="https://i.niupic.com/images/2020/09/04/8CXP.png",this.down_bird0.src="https://i.niupic.com/images/2020/09/04/8CXQ.png",this.down_bird1.src="https://i.niupic.com/images/2020/09/04/8CXR.png",this.startBtn.src="https://i.niupic.com/images/2020/09/04/8CXI.jpg",this.up_pipe.src="https://i.niupic.com/images/2020/09/04/8CXS.png",this.up_mod.src="https://i.niupic.com/images/2020/09/04/8CXT.png",this.down_pipe.src="https://i.niupic.com/images/2020/09/04/8CXF.png",this.down_mod.src="https://i.niupic.com/images/2020/09/04/8CXU.png";var t=this,e=setInterval((function(){t.bg.complete&&t.grass.complete&&t.title.complete&&t.startBtn.complete&&t.bird0.complete&&t.bird1.complete&&t.up_bird0.complete&&t.up_bird1.complete&&t.down_bird0.complete&&t.down_bird1.complete&&t.up_pipe.complete&&t.up_mod.complete&&t.down_mod.complete&&t.down_pipe.complete&&(clearInterval(e),i())}),50)}};var i=[imgs.bird0,imgs.bird1],t=[imgs.up_bird0,imgs.up_bird1],e=[imgs.down_bird0,imgs.down_bird1];class s{constructor(i,t){this.i=0,this.posX=100,this.posY=200,this.speed=0,this.alive=!0,this.ctx=t,this.gameoverCb=i}_draw(i){this.ctx.drawImage(i,this.posX,this.posY)}fly(){if(this.posY+=this.speed,this.speed+=.1,this.posY<10&&(this.posY=10),this.posY>=420)return this._draw(i[this.i]),void this.setDeath("fly to the bottom");this.speed<0?this._draw(t[this.i]):this.speed>0?this._draw(e[this.i]):this._draw(i[this.i]),this._wing()}_wing(){this.i++,2===this.i&&(this.i=0)}setDeath(i){this.alive=!1,this.gameoverCb(i)}}class n{constructor(i){this.up=imgs.up_pipe,this.up_mod=imgs.up_mod,this.down=imgs.down_pipe,this.down_mod=imgs.down_mod,this.done=!1,this.X=300,this.up_Y=Math.floor(50*Math.random()),this.down_Y=3*(50-this.up_Y),this.pos_up_Y=3*this.up_Y+this.up.height,this.pos_down_Y=362-this.down_Y,this.ctx=i}draw(){this.ctx.drawImage(this.up,this.X,3*this.up_Y),this.ctx.drawImage(this.down,this.X,362-this.down_Y);for(var i=0;i<this.up_Y;i++)this.ctx.drawImage(this.up_mod,this.X,3*i);for(var t=0;t<this.down_Y;t++)this.ctx.drawImage(this.down_mod,this.X,420-this.down_Y+this.down_mod.height+t)}move(){this.X-=3,this.draw()}setDone(){this.done=!0}}var o=document.getElementById("container"),h=document.getElementById("canvas"),d=document.getElementById("startBtn"),p=document.getElementById("score"),m=h.getContext("2d"),r=new s(a,m);function a(i){console.log("#reason",i),m.font="50px blod",m.fontWeight="1000",m.fillStyle="white",m.fillText("GAME OVER",20,200),m.font="20px blod",m.fillStyle="white",m.fillText("âœ‹ PLAY AGAIN",100,250),h.addEventListener("click",g.reset,!1)}function c(){r.speed=-2}document.body.addEventListener("touchmove",(function(i){i.preventDefault()}),!1),window.addEventListener("click",c,!1),window.addEventListener("touchstart",c,!1),d.addEventListener("click",(function(){o.style.display="none",h.style.visibility="visible",g.init()}));var g={limit:2,queue:[],flag:0,num:Math.floor(70+20*Math.random()),bird_width:40,pipe_width:62,score:0,init:function(){imgs.loadImg(g.draw)},reset:function(){g.limit=2,g.queue=[],g.flag=0,g.num=Math.floor(70+20*Math.random()),g.score=0,r=new s(a,m),m.clearRect(0,0,343,480),p.innerText=0,o.style.display="block",h.style.visibility="hidden",h.removeEventListener("click",g.reset,!1)},piping:function(){if(this.flag<this.num)this.flag++;else{var i=new n(m);this.queue.length<this.limit||this.queue.shift(),this.queue.push(i),this.flag=0,this.num=g.num}this.queue.forEach(i=>{i.move(),this.isHit(i)})},isHit:function(i){var t=r.posX,e=r.posY,s=i.X;t+this.bird_width>s&&t<s+this.pipe_width&&(e<i.pos_up_Y?r.setDeath("HIT UP_PIPE "):e+30>i.pos_down_Y&&r.setDeath("HIT DOWN_PIPE")),t>s+this.pipe_width&&!1===i.done&&(i.setDone(),g.score++,p.innerText=g.score)},moving:function(){m.clearRect(0,0,343,480),m.drawImage(imgs.bg,0,0),r.fly(),g.piping(),r.alive&&window.requestAnimationFrame(g.moving)},draw:function(){m.drawImage(imgs.bg,0,0),window.requestAnimationFrame(g.moving)}};
