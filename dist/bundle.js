/*!
 * flappy bird.js v1.0.0
 * (c) 2020 Lin.JY
 * Released under the MIT License.
 */
"use strict";window.imgs={bg:new Image,grass:new Image,title:new Image,bird0:new Image,bird1:new Image,up_bird0:new Image,up_bird1:new Image,down_bird0:new Image,down_bird1:new Image,startBtn:new Image,up_pipe:new Image,up_mod:new Image,down_pipe:new Image,down_mod:new Image,loadImg:function(i){this.bg.src="https://i.niupic.com/images/2020/09/04/8CXx.jpg",this.bird0.src="https://i.niupic.com/images/2020/09/04/8CXA.png",this.bird1.src="https://i.niupic.com/images/2020/09/04/8CXC.png",this.up_bird0.src="https://i.niupic.com/images/2020/09/04/8CXO.png",this.up_bird1.src="https://i.niupic.com/images/2020/09/04/8CXP.png",this.down_bird0.src="https://i.niupic.com/images/2020/09/04/8CXQ.png",this.down_bird1.src="https://i.niupic.com/images/2020/09/04/8CXR.png",this.startBtn.src="data:image/jpeg;base64,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",this.up_pipe.src="https://i.niupic.com/images/2020/09/04/8CXS.png",this.up_mod.src="https://i.niupic.com/images/2020/09/04/8CXT.png",this.down_pipe.src="https://i.niupic.com/images/2020/09/04/8CXF.png",this.down_mod.src="https://i.niupic.com/images/2020/09/04/8CXU.png";var t=this,e=setInterval((function(){t.bg.complete&&t.grass.complete&&t.title.complete&&t.startBtn.complete&&t.bird0.complete&&t.bird1.complete&&t.up_bird0.complete&&t.up_bird1.complete&&t.down_bird0.complete&&t.down_bird1.complete&&t.up_pipe.complete&&t.up_mod.complete&&t.down_mod.complete&&t.down_pipe.complete&&(clearInterval(e),i())}),50)}};var i=[imgs.bird0,imgs.bird1],t=[imgs.up_bird0,imgs.up_bird1],e=[imgs.down_bird0,imgs.down_bird1];class s{constructor(i,t){this.i=0,this.posX=100,this.posY=200,this.speed=0,this.alive=!0,this.ctx=t,this.gameoverCb=i}_draw(i){this.ctx.drawImage(i,this.posX,this.posY)}fly(){if(this.posY+=this.speed,this.speed+=.1,this.posY<10&&(this.posY=10),this.posY>=420)return this._draw(i[this.i]),void this.setDeath("fly to the bottom");this.speed<0?this._draw(t[this.i]):this.speed>0?this._draw(e[this.i]):this._draw(i[this.i]),this._wing()}_wing(){this.i++,2===this.i&&(this.i=0)}setDeath(i){this.alive=!1,this.gameoverCb(i)}}class n{constructor(i){this.up=imgs.up_pipe,this.up_mod=imgs.up_mod,this.down=imgs.down_pipe,this.down_mod=imgs.down_mod,this.done=!1,this.X=300,this.up_Y=Math.floor(50*Math.random()),this.down_Y=3*(50-this.up_Y),this.pos_up_Y=3*this.up_Y+this.up.height,this.pos_down_Y=362-this.down_Y,this.ctx=i}draw(){this.ctx.drawImage(this.up,this.X,3*this.up_Y),this.ctx.drawImage(this.down,this.X,362-this.down_Y);for(var i=0;i<this.up_Y;i++)this.ctx.drawImage(this.up_mod,this.X,3*i);for(var t=0;t<this.down_Y;t++)this.ctx.drawImage(this.down_mod,this.X,420-this.down_Y+this.down_mod.height+t)}move(){this.X-=3,this.draw()}setDone(){this.done=!0}}var o=document.getElementById("container"),d=document.getElementById("canvas"),h=document.getElementById("startBtn"),A=document.getElementById("score"),p=d.getContext("2d"),m=new s(r,p);function r(i){console.log("#reason",i),p.font="50px blod",p.fontWeight="1000",p.fillStyle="white",p.fillText("GAME OVER",20,200),p.font="20px blod",p.fillStyle="white",p.fillText("âœ‹ PLAY AGAIN",100,250),d.addEventListener("click",c.reset,!1)}function a(){m.speed=-2}document.body.addEventListener("touchmove",(function(i){i.preventDefault()}),!1),window.addEventListener("click",a,!1),window.addEventListener("touchstart",a,!1),h.addEventListener("click",(function(){o.style.display="none",d.style.visibility="visible",c.init()}));var c={limit:2,queue:[],flag:0,num:Math.floor(70+20*Math.random()),bird_width:40,pipe_width:62,score:0,init:function(){imgs.loadImg(c.draw)},reset:function(){c.limit=2,c.queue=[],c.flag=0,c.num=Math.floor(70+20*Math.random()),c.score=0,m=new s(r,p),p.clearRect(0,0,343,480),A.innerText=0,o.style.display="block",d.style.visibility="hidden",d.removeEventListener("click",c.reset,!1)},piping:function(){if(this.flag<this.num)this.flag++;else{var i=new n(p);this.queue.length<this.limit||this.queue.shift(),this.queue.push(i),this.flag=0,this.num=c.num}this.queue.forEach(i=>{i.move(),this.isHit(i)})},isHit:function(i){var t=m.posX,e=m.posY,s=i.X;t+this.bird_width>s&&t<s+this.pipe_width&&(e<i.pos_up_Y?m.setDeath("HIT UP_PIPE "):e+30>i.pos_down_Y&&m.setDeath("HIT DOWN_PIPE")),t>s+this.pipe_width&&!1===i.done&&(i.setDone(),c.score++,A.innerText=c.score)},moving:function(){p.clearRect(0,0,343,480),p.drawImage(imgs.bg,0,0),m.fly(),c.piping(),m.alive&&window.requestAnimationFrame(c.moving)},draw:function(){p.drawImage(imgs.bg,0,0),window.requestAnimationFrame(c.moving)}};
